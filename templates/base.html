<!DOCTYPE html>
<html>

  <head>
    <title>{{ title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap -->
    <link href="{{ static_url('css/bootstrap.min.css') }}" rel="stylesheet">

    <!-- Icons -->
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <!-- Static navbar -->
    <div class="navbar navbar-default" role="navigation">
      <div class="navbar-header">
        <div class="navbar-toggle" data-toggle="collapse"
          data-target=".navbar-collapse"><i class="fa fa-bars"></i></div>
        <a class="navbar-brand" href="/">{{ title }}</a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="/">{{ _('Fleets') }}</a></li>
          <li><a href="http://raisa.su/rules">{{ _('Rules') }}</a></li>
          <li><a href="http://raisa.su/fits">{{ _('Fits') }}</a></li>
          <li><a href="http://raisa.su/srp">{{ _('SRP') }}</a></li>
          <li><a href="http://raisa.su/guides">{{ _('Guides') }}</a></li>
          <li><a href="http://raisa.su/about">{{ _('About us') }}</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          {% if character is not None %}
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ character.name }} <b class="caret"></b></a>
            <ul class="dropdown-menu">
              {% if character.is_admin %}<li><a href="/admin">{{ _('Admin') }}</a></li>{% end %}
              <li><a href="/fit">{{ _('Fit') }}</a></li>
              <li><a href="/logout">{{ _('Logout') }}</a></li>
            </ul>
          </li>
          {% elif trusted %}
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ eve['charname'] }} <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="/login">{{ _('Authenticate') }}</a></li>
            </ul>
          </li>
          {% end %}
        </ul>
      </div><!--/.nav-collapse -->
    </div>

    <div class="container">

      {% for msgid, message, cls in messages %}
      <div id="{{ msgid }}" class="alert alert-{{ cls }}">
          <button type="button" class="close" onclick='javascript:readMessage("{{ msgid }}")'>&times;</button>
          <p>{{ message }}</p>
      </div>
      {% end %}

      {% block content %}
      {% end %}
    </div>

    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="{{ static_url('js/bootstrap.min.js') }}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.9/angular.min.js"></script>

    <script>
    function getCookie(name) {
      var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");
      return r ? r[1] : undefined;
    }
    function deleteCookie(name) {
      document.cookie = name+'="";-1; path=/';
    }
    function readMessage(msg) {
      $.post('/read', {msg: msg});
      $('#' + msg).remove();
    }
    function logout() {
      deleteCookie("character");
      document.location = "/";
    }
    $.ajaxSetup({headers: {'X-XSRFToken': getCookie("_xsrf")} });
    </script>

    {% if character %}
    <script>
    function polling() {
        $.getJSON('/poll')
        .done(function(data) {
          if (data.action == 'reload') {
            {% if reload_on_poll %}
            document.location.reload();
            {% else %}
            setTimeout(polling, 500);
            {% end %}
          }
          {% block poll_handlers %}
          {% end %}
        })
        .fail(function() {
          setTimeout(polling, 5000);
        })
    }
    $(polling);
    </script>
    {% end %}

    {% block addjs %}
    {% end %}

  </body>
</html>
